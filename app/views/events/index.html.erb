
<!-- 網站特色 -->
<div id="website-feaures" class="container-fluid row">
  <div class="title col-sm-12">
    <h2>The Wall</h2>
    <p>可以提供給您...</p>
  </div>
  <div class="website-feature col-sm-4">
    <p><%= icon('fas', 'bullhorn', class: "index-icon") %></p>
    <div class="feature-detail">
      <p>提醒您喜愛的樂團的演出</p>
    </div>
  </div>
  <div class="website-feature col-sm-4">
    <p><%= icon('fas', 'compass', class: "index-icon") %></p>
    <div class="feature-detail">
      <p>快速找到您要的表演</p>
    </div>
  </div>
  <div class="website-feature col-sm-4">
    <p><%= icon('fas', 'music', class: "index-icon") %></p>
    <div class="feature-detail">
      <p>開拓您對Indie的認識</p>
    </div>
  </div>
</div>

<!-- 近期表演 -->
<div id="recent-events" class="container-fluid row">
  <div class="col-sm-7 text-right">
    <h2 >近期表演資訊</h2>
  </div>
  <div class="col-sm-5 text-right">
    <%= search_form_for @events_search do |f|%>
        <%= f.label :name_or_intro_or_date_or_time_or_ticket_link_or_price_cont, "搜尋表演"%>
        <%= f.search_field :name_or_intro_or_date_or_time_or_ticket_link_or_price_cont %>
      <%=f.submit "搜尋"%>
    <% end %>
  </div>



  <% @events.each do |event| %>
    <div class="recent-event col-md-4">
      <%= render partial: "shared/event_template", locals: {event: event} %>
    </div>
  <% end %>
  <h3><%= link_to "看更多...", all_events_events_path, class: "btn btn-primary float-sm-right" %></h3>
</div>
<br />


<!-- Google Map-->
  <script src="//maps.google.com/maps/api/js?key=AIzaSyC6XOGbKNgafoPUmAC_J3JCATY-4AaGkVE"></script>
  <script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
  <script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
  <h1>展演地點</h1>
  <div class="row">
    <div class="col-md-4">
      <button type="button" class="location taipei btn btn-secondary">台北</button>
    </div>
    <div class="col-md-4">
      <button type="button" class="location taichung btn btn-secondary">台中</button>
    </div>
    <div class="col-md-4">
      <button type="button" class="location kaohsiung btn btn-secondary">高雄</button>
    </div>
  </div>


  <ul id="markers_list">  </ul>
  <div id="map" style='width: 100%; height: 400px;'></div>

  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({
        provider: {
          // Center: {lat:121, lng: 23},
          // Zoom: 3
          // pass in other Google Maps API options here
        },
        internal: {
          id: 'map'
        }
      },
      function(){
        var location = new Map();
        location.set("Taipei", []);
        location.set("Taichung", []);
        location.set("Kaohsiung", [22.642, 120.318, 10]);

        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        handler.getMap().setZoom(7);
        handler.map.centerOn([23.5, 121]);
      }
    );

  </script>

  <!-- Follow Ajax -->
  <script>
    $('.follow-box').on("click", ".follow-a", function(event) {
      var id = event.target.parentNode.id;
      console.log(id);
      $.ajax({
        url: "/events/" + id + "/follow",
        method: "POST",
        dataType: "json",
        success: function(data) {
          $('#'+data["id"]).html($('#event-unfollow-template').html());
        }
      });
    });
  </script>

  <!-- Unfollow Ajax -->
  <script>
    $('.follow-box').on("click", ".unfollow-a", function(event) {
      var id = event.target.parentNode.id;
      $.ajax({
        url: "/events/" + id + "/unfollow",
        method: "POST",
        dataType: "json",
        success: function(data) {
          $('#'+data["id"]).html($('#event-follow-template').html());
        }
      });
    });
  </script>

  <script type="text/template" id="event-follow-template">
    <button type="button" class="follow-a follow-event btn btn-warning btn-sm">Follow</button>
  </script>
  <script type="text/template" id="event-unfollow-template">
    <button type="button" class="unfollow-a follow-event btn btn-warning btn-sm">Unfollow</button>
  </script>
